node{
	
	def mavenHome = tool name: "maven3.6.3"
	
	properties([buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '5', daysToKeepStr: '', numToKeepStr: '5')), pipelineTriggers([pollSCM('* * * * *')])])
	
	stage('CheckOutCode'){
	
	git branch: 'development', credentialsId: 'ede57fc4-5b73-48bd-b5a7-49c73d224f12', url: 'https://github.com/HarshithaKuppam/maven-web-application.git'
	}
	
stage('Build') {

sh "${mavenHome}/bin/mvn clean package"
}
	
	
stage('Execute SQ report'){

sh "${mavenHome}/bin/mvn sonar:sonar" 

}


stage('UploadArtifactIntoNexus'){

sh "${mavenHome}/bin/mvn deploy" 

}


stage('DeployApplicationIntoTomcatServer'){

sshagent(['0d60a22f-da7d-4b87-89f9-4a84ddc4ac28']) {
  
  sh "scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@13.232.25.247:/opt/apache-tomcat-9.0.46/webapps"
}

}


stage('send email notification'){


emailext body: '''Hi,
Build is completed

Regards,
Harshitha''', subject: 'Build is over!!', to: 'harshithakn0801@gmail.com'

}


	}
